<h1>Traces GPX enregistrées</h1>

<mat-card class="filter-card">

  <mat-card-header>
    <mat-card-title>
      <mat-icon>filter_list</mat-icon>
      Filtres
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>

    <!-- Distance -->
    <div class="filter-row">
      <mat-form-field appearance="outline">
        <mat-label>Distance min (km)</mat-label>
        <input matInput type="number"
               [(ngModel)]="minDistance"
               (change)="applyFilters()">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Distance max (km)</mat-label>
        <input matInput type="number"
               [(ngModel)]="maxDistance"
               (change)="applyFilters()">
      </mat-form-field>
    </div>

    <!-- Dénivelé -->
    <div class="filter-row">
      <mat-form-field appearance="outline">
        <mat-label>Dénivelé min (m)</mat-label>
        <input matInput type="number"
               [(ngModel)]="minDenivele"
               (change)="applyFilters()">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Dénivelé max (m)</mat-label>
        <input matInput type="number"
               [(ngModel)]="maxDenivele"
               (change)="applyFilters()">
      </mat-form-field>
    </div>

    <mat-divider></mat-divider>

    <!-- Mots-clés -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Ajouter des mots-clés</mat-label>
      <mat-icon matPrefix>search</mat-icon>
      <input matInput
             type="text"
             [(ngModel)]="keywordsInput"
             (keydown.enter)="addKeyword(); $event.preventDefault()"
             placeholder="Tapez un mot et appuyez sur Entrée">
    </mat-form-field>

    <!-- Chips -->
    <mat-chip-set>
      @for (k of keywords; track $index) {
        <mat-chip
          removable="true"
          (removed)="removeKeyword(k)">
          {{ k }}
          <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
      }
    </mat-chip-set>

    <mat-divider></mat-divider>

    <!-- Niveaux -->
    <div class="checkbox-group">
      @for (n of niveaux; track $index) {
        <mat-checkbox
          (change)="toggleNiveau(n)">
          {{ n }}
        </mat-checkbox>
      }
    </div>

  </mat-card-content>

</mat-card>


<table>
    <thead>
        <tr>
            <th>Sélectionner</th>
            <th (click)="sortColumn(1)">Nom <span>{{ getSortIcon(1) }}</span></th>
            <th (click)="sortColumn(2)">Description <span>{{ getSortIcon(2) }}</span></th>
            <th (click)="sortColumn(3)">Niveau <span>{{ getSortIcon(3) }}</span></th>
            <th (click)="sortColumn(4)">Distance (km) <span>{{ getSortIcon(4) }}</span></th>
            <th (click)="sortColumn(5)">Dénivelé (m) <span>{{ getSortIcon(5) }}</span></th>
            <th (click)="sortColumn(6)">Date parcours <span>{{ getSortIcon(6) }}</span></th>
            <th>GPX</th>
            <th>difficulte été</th>
            <th>difficulte hiver</th>
        </tr>
    </thead>
    
    <tbody>
        @for (t of filtered; track $index) {
            <tr>
                <td>
                    <mat-checkbox
                    (change)="handleSelectionStatus($event, t)"
                    >
                </mat-checkbox>
                </td>
                <td>{{ t.nom }}</td>
                <td>{{ t.description }}</td>
                <td>{{ t.niveau }}</td>
                <td>{{ t.distance_km }}</td>
                <td>{{ t.denivele }}</td>
                <td>{{ t.date_parcours }}</td>
                <td>
                    <button (click)="download(t)">Télécharger</button>
                </td>
                <td [style.background]="t.difficulte?.normal" [title]="t.difficulte?.niveauNormal"></td>
                <td [style.background]="t.difficulte?.difficile" [title]="t.difficulte?.niveauDifficile"></td>
            </tr>
        } @empty {
            <tr>
                <td id="filtered-traces-empty" colspan="10">
                    Aucune trace ne correspond aux filtres sélectionnés, ou aucune trace n'est enregistrée dans le système.
                </td>
            </tr>
        }
    </tbody>
</table>
