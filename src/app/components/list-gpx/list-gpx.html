<h1>Traces GPX enregistrées</h1>

<fieldset>
    <legend>Filtres</legend>
    
    Distance :
    <input type="number" [(ngModel)]="minDistance" (change)="applyFilters()"> -
    <input type="number" [(ngModel)]="maxDistance" (change)="applyFilters()">
    
    <br><br>
    
    Dénivelé :
    <input type="number" [(ngModel)]="minDenivele" (change)="applyFilters()"> -
    <input type="number" [(ngModel)]="maxDenivele" (change)="applyFilters()">
    
    <br><br>
    
    Mots-clés :
    <input type="text" [(ngModel)]="keywordsInput"
    (keydown.enter)="addKeyword(); $event.preventDefault()"
    placeholder="Tapez un mot et Entrée">
    
    <div style="margin-top:5px;">
        @for (k of keywords; track $index) {
            <span style="display:inline-block; padding:3px 8px; margin:2px; background:#ff6600; color:white; border-radius:12px;">
                {{k}} <span style="cursor:pointer;" (click)="removeKeyword(k)">×</span>
            </span>
        }
        
    </div>
    
    <br><br>
    
    <div>
        @for (n of niveaux; track $index) {
            <label>
                <input type="checkbox" (change)="toggleNiveau(n)"> {{ n }}
            </label>
        }
        
    </div>
</fieldset>

<table>
    <thead>
        <tr>
            <th (click)="sortColumn(0)">Sélectionner <span>{{ getSortIcon(0) }}</span></th>
            <th (click)="sortColumn(1)">Nom <span>{{ getSortIcon(1) }}</span></th>
            <th (click)="sortColumn(2)">Description <span>{{ getSortIcon(2) }}</span></th>
            <th (click)="sortColumn(3)">Niveau <span>{{ getSortIcon(3) }}</span></th>
            <th (click)="sortColumn(4)">Distance (km) <span>{{ getSortIcon(4) }}</span></th>
            <th (click)="sortColumn(5)">Dénivelé (m) <span>{{ getSortIcon(5) }}</span></th>
            <th (click)="sortColumn(6)">Date parcours <span>{{ getSortIcon(6) }}</span></th>
            <th>GPX</th>
            <th>difficulte été</th>
            <th>difficulte hiver</th>
        </tr>
    </thead>
    
    <tbody>
        @for (t of filtered; track $index) {
            <tr>
                <td>
                    <mat-checkbox
                    (change)="handleSelectionStatus($event, t)"
                    >
                </mat-checkbox>
            </td>
            <td>{{ t.nom }}</td>
            <td>{{ t.description }}</td>
            <td>{{ t.niveau }}</td>
            <td>{{ t.distance_km }}</td>
            <td>{{ t.denivele }}</td>
            <td>{{ t.date_parcours }}</td>
            <td>
                <button (click)="download(t)">Télécharger</button>
            </td>
            <td [style.background]="t.difficulte?.normal" [title]="t.difficulte?.niveauNormal"></td>
            <td [style.background]="t.difficulte?.difficile" [title]="t.difficulte?.niveauDifficile"></td>
        </tr>
    }
    
</tbody>
</table>
